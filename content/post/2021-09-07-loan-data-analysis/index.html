---
title: "Loan data analysis"
author: "Gabe Mednick"
date: '2021-09-07'
output:
  bookdown::html_document2:
  number_sections: TRUE
  fig_caption: TRUE
categories: []
tags: []
subtitle: ''
summary: Predicting loan type, loan risk and loan payment status
authors: []
lastmod: ''
featured: no
image:
  caption: ''
  focal_point: ''
  preview_only: no
projects: []
slug: loans
---

<script src="{{< blogdown/postref >}}index_files/header-attrs/header-attrs.js"></script>


<div id="loan-data" class="section level1">
<h1>Loan Data</h1>
<p>This dataset (<a href="https://www.kaggle.com/itssuru/loan-data">source</a>) consists of data from almost 10,000 borrowers that took loans - with some paid back and others still in progress. It was extracted from lendingclub.com which is an organization that connects borrowers with investors. We’ve included a few suggested questions at the end of this template to help you get started.</p>
<div id="understand-your-data" class="section level3">
<h3>Understand your data</h3>
<table>
<colgroup>
<col width="20%" />
<col width="20%" />
<col width="59%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Variable</th>
<th align="left">class</th>
<th align="left">description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">credit_policy</td>
<td align="left">numeric</td>
<td align="left">1 if the customer meets the credit underwriting criteria; 0 otherwise.</td>
</tr>
<tr class="even">
<td align="left">purpose</td>
<td align="left">character</td>
<td align="left">The purpose of the loan.</td>
</tr>
<tr class="odd">
<td align="left">int_rate</td>
<td align="left">numeric</td>
<td align="left">The interest rate of the loan (more risky borrowers are assigned higher interest rates).</td>
</tr>
<tr class="even">
<td align="left">installment</td>
<td align="left">numeric</td>
<td align="left">The monthly installments owed by the borrower if the loan is funded.</td>
</tr>
<tr class="odd">
<td align="left">log_annual_inc</td>
<td align="left">numeric</td>
<td align="left">The natural log of the self-reported annual income of the borrower.</td>
</tr>
<tr class="even">
<td align="left">dti</td>
<td align="left">numeric</td>
<td align="left">The debt-to-income ratio of the borrower (amount of debt divided by annual income).</td>
</tr>
<tr class="odd">
<td align="left">fico</td>
<td align="left">numeric</td>
<td align="left">The FICO credit score of the borrower.</td>
</tr>
<tr class="even">
<td align="left">days_with_cr_line</td>
<td align="left">numeric</td>
<td align="left">The number of days the borrower has had a credit line.</td>
</tr>
<tr class="odd">
<td align="left">revol_bal</td>
<td align="left">numeric</td>
<td align="left">The borrower’s revolving balance (amount unpaid at the end of the credit card billing cycle).</td>
</tr>
<tr class="even">
<td align="left">revol_util</td>
<td align="left">numeric</td>
<td align="left">The borrower’s revolving line utilization rate (the amount of the credit line used relative to total credit available).</td>
</tr>
<tr class="odd">
<td align="left">inq_last_6mths</td>
<td align="left">numeric</td>
<td align="left">The borrower’s number of inquiries by creditors in the last 6 months.</td>
</tr>
<tr class="even">
<td align="left">delinq_2yrs</td>
<td align="left">numeric</td>
<td align="left">The number of times the borrower had been 30+ days past due on a payment in the past 2 years.</td>
</tr>
<tr class="odd">
<td align="left">pub_rec</td>
<td align="left">numeric</td>
<td align="left">The borrower’s number of derogatory public records.</td>
</tr>
<tr class="even">
<td align="left">not_fully_paid</td>
<td align="left">numeric</td>
<td align="left">1 if the loan is not fully paid; 0 otherwise.</td>
</tr>
</tbody>
</table>
</div>
<div id="load-packages" class="section level3">
<h3>Load packages</h3>
<pre class="r"><code># install.packages(&#39;ggridges&#39;)
# install.packages(&#39;patchwork&#39;)
# install.packages(&#39;gt&#39;)
# install.packages(&#39;xgboost&#39;)
# install.packages(&#39;ranger&#39;)
# install.packages(&#39;vip&#39;)
# install.packages(&#39;usemodels&#39;)
# install.packages(&#39;GGally&#39;)
# install.packages(&#39;doParallel&#39;)
# install.packages(&#39;glmnet&#39;)
library(skimr)
library(tidyverse)
library(tidymodels)
library(scales)
library(ggridges)
library(patchwork)
library(gt)
library(xgboost)
library(ranger)
library(vip)
library(usemodels)
library(GGally)
library(glmnet)
doParallel::registerDoParallel()
theme_set(theme_light())</code></pre>
</div>
<div id="load-your-data" class="section level3">
<h3>Load your Data</h3>
<pre class="r"><code>loans &lt;- readr::read_csv(&#39;loans.csv.gz&#39;)</code></pre>
</div>
</div>
<div id="exploratory-data-analysis" class="section level1">
<h1>Exploratory data analysis</h1>
<p>As a strong visual learner, it helps me to see the data in both table and plot formats. Let’s get started by looking at a few the summary statistics generated from the <code>skimr::skim()</code> combined with <code>summary()</code>. I will also use <code>glimpse()</code> to get a concise view of the data names, type and first few entries.</p>
<pre class="r"><code>loans %&gt;% 
  skim() %&gt;% 
  select(-(numeric.p0:numeric.p100)) %&gt;%
  select(-(complete_rate)) %&gt;% 
  summary()</code></pre>
<table>
<caption><span id="tab:unnamed-chunk-2">Table 1: </span>Data summary</caption>
<tbody>
<tr class="odd">
<td align="left">Name</td>
<td align="left">Piped data</td>
</tr>
<tr class="even">
<td align="left">Number of rows</td>
<td align="left">9578</td>
</tr>
<tr class="odd">
<td align="left">Number of columns</td>
<td align="left">14</td>
</tr>
<tr class="even">
<td align="left">_______________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Column type frequency:</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">character</td>
<td align="left">1</td>
</tr>
<tr class="odd">
<td align="left">numeric</td>
<td align="left">13</td>
</tr>
<tr class="even">
<td align="left">________________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Group variables</td>
<td align="left">None</td>
</tr>
</tbody>
</table>
<pre class="r"><code>loans %&gt;% 
  glimpse()</code></pre>
<pre><code>## Rows: 9,578
## Columns: 14
## $ credit_policy     &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…
## $ purpose           &lt;chr&gt; &quot;debt_consolidation&quot;, &quot;credit_card&quot;, &quot;debt_consolida…
## $ int_rate          &lt;dbl&gt; 0.1189, 0.1071, 0.1357, 0.1008, 0.1426, 0.0788, 0.14…
## $ installment       &lt;dbl&gt; 829.10, 228.22, 366.86, 162.34, 102.92, 125.13, 194.…
## $ log_annual_inc    &lt;dbl&gt; 11.350407, 11.082143, 10.373491, 11.350407, 11.29973…
## $ dti               &lt;dbl&gt; 19.48, 14.29, 11.63, 8.10, 14.97, 16.98, 4.00, 11.08…
## $ fico              &lt;dbl&gt; 737, 707, 682, 712, 667, 727, 667, 722, 682, 707, 67…
## $ days_with_cr_line &lt;dbl&gt; 5639.958, 2760.000, 4710.000, 2699.958, 4066.000, 61…
## $ revol_bal         &lt;dbl&gt; 28854, 33623, 3511, 33667, 4740, 50807, 3839, 24220,…
## $ revol_util        &lt;dbl&gt; 52.1, 76.7, 25.6, 73.2, 39.5, 51.0, 76.8, 68.6, 51.1…
## $ inq_last_6mths    &lt;dbl&gt; 0, 0, 1, 1, 0, 0, 0, 0, 1, 1, 2, 2, 0, 0, 0, 1, 0, 1…
## $ delinq_2yrs       &lt;dbl&gt; 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0…
## $ pub_rec           &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0…
## $ not_fully_paid    &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…</code></pre>
<pre class="r"><code>loans %&gt;% 
  head() %&gt;% 
  gt() %&gt;%
  tab_header(title = md(&quot;**First 6 rows of loan data from lendingclub.com**&quot;))  %&gt;%
  tab_options(container.height = 400,
              container.overflow.y = TRUE,
              heading.background.color = &quot;#21908CFF&quot;,
              table.width = &quot;75%&quot;,
              column_labels.background.color = &quot;black&quot;,
              table.font.color = &quot;black&quot;) %&gt;%
  tab_style(style = list(cell_fill(color = &quot;#35B779FF&quot;)),
            locations = cells_body())</code></pre>
<div id="npvtxfphva" style="overflow-x:auto;overflow-y:auto;width:auto;height:400px;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#npvtxfphva .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: black;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: 75%;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#npvtxfphva .gt_heading {
  background-color: #21908CFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#npvtxfphva .gt_title {
  color: #FFFFFF;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#npvtxfphva .gt_subtitle {
  color: #FFFFFF;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#npvtxfphva .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#npvtxfphva .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#npvtxfphva .gt_col_heading {
  color: #FFFFFF;
  background-color: black;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#npvtxfphva .gt_column_spanner_outer {
  color: #FFFFFF;
  background-color: black;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#npvtxfphva .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#npvtxfphva .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#npvtxfphva .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#npvtxfphva .gt_group_heading {
  padding: 8px;
  color: black;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#npvtxfphva .gt_empty_group_heading {
  padding: 0.5px;
  color: black;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#npvtxfphva .gt_from_md > :first-child {
  margin-top: 0;
}

#npvtxfphva .gt_from_md > :last-child {
  margin-bottom: 0;
}

#npvtxfphva .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#npvtxfphva .gt_stub {
  color: black;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#npvtxfphva .gt_summary_row {
  color: black;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#npvtxfphva .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#npvtxfphva .gt_grand_summary_row {
  color: black;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#npvtxfphva .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#npvtxfphva .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#npvtxfphva .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#npvtxfphva .gt_footnotes {
  color: black;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#npvtxfphva .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#npvtxfphva .gt_sourcenotes {
  color: black;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#npvtxfphva .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#npvtxfphva .gt_left {
  text-align: left;
}

#npvtxfphva .gt_center {
  text-align: center;
}

#npvtxfphva .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#npvtxfphva .gt_font_normal {
  font-weight: normal;
}

#npvtxfphva .gt_font_bold {
  font-weight: bold;
}

#npvtxfphva .gt_font_italic {
  font-style: italic;
}

#npvtxfphva .gt_super {
  font-size: 65%;
}

#npvtxfphva .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}
</style>
<table class="gt_table">
  <thead class="gt_header">
    <tr>
      <th colspan="14" class="gt_heading gt_title gt_font_normal gt_bottom_border" style><strong>First 6 rows of loan data from lendingclub.com</strong></th>
    </tr>
    
  </thead>
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">credit_policy</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">purpose</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">int_rate</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">installment</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">log_annual_inc</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">dti</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">fico</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">days_with_cr_line</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">revol_bal</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">revol_util</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">inq_last_6mths</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">delinq_2yrs</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">pub_rec</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">not_fully_paid</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_right" style="background-color: #35B779;">1</td>
<td class="gt_row gt_left" style="background-color: #35B779;">debt_consolidation</td>
<td class="gt_row gt_right" style="background-color: #35B779;">0.1189</td>
<td class="gt_row gt_right" style="background-color: #35B779;">829.10</td>
<td class="gt_row gt_right" style="background-color: #35B779;">11.35041</td>
<td class="gt_row gt_right" style="background-color: #35B779;">19.48</td>
<td class="gt_row gt_right" style="background-color: #35B779;">737</td>
<td class="gt_row gt_right" style="background-color: #35B779;">5639.958</td>
<td class="gt_row gt_right" style="background-color: #35B779;">28854</td>
<td class="gt_row gt_right" style="background-color: #35B779;">52.1</td>
<td class="gt_row gt_right" style="background-color: #35B779;">0</td>
<td class="gt_row gt_right" style="background-color: #35B779;">0</td>
<td class="gt_row gt_right" style="background-color: #35B779;">0</td>
<td class="gt_row gt_right" style="background-color: #35B779;">0</td></tr>
    <tr><td class="gt_row gt_right" style="background-color: #35B779;">1</td>
<td class="gt_row gt_left" style="background-color: #35B779;">credit_card</td>
<td class="gt_row gt_right" style="background-color: #35B779;">0.1071</td>
<td class="gt_row gt_right" style="background-color: #35B779;">228.22</td>
<td class="gt_row gt_right" style="background-color: #35B779;">11.08214</td>
<td class="gt_row gt_right" style="background-color: #35B779;">14.29</td>
<td class="gt_row gt_right" style="background-color: #35B779;">707</td>
<td class="gt_row gt_right" style="background-color: #35B779;">2760.000</td>
<td class="gt_row gt_right" style="background-color: #35B779;">33623</td>
<td class="gt_row gt_right" style="background-color: #35B779;">76.7</td>
<td class="gt_row gt_right" style="background-color: #35B779;">0</td>
<td class="gt_row gt_right" style="background-color: #35B779;">0</td>
<td class="gt_row gt_right" style="background-color: #35B779;">0</td>
<td class="gt_row gt_right" style="background-color: #35B779;">0</td></tr>
    <tr><td class="gt_row gt_right" style="background-color: #35B779;">1</td>
<td class="gt_row gt_left" style="background-color: #35B779;">debt_consolidation</td>
<td class="gt_row gt_right" style="background-color: #35B779;">0.1357</td>
<td class="gt_row gt_right" style="background-color: #35B779;">366.86</td>
<td class="gt_row gt_right" style="background-color: #35B779;">10.37349</td>
<td class="gt_row gt_right" style="background-color: #35B779;">11.63</td>
<td class="gt_row gt_right" style="background-color: #35B779;">682</td>
<td class="gt_row gt_right" style="background-color: #35B779;">4710.000</td>
<td class="gt_row gt_right" style="background-color: #35B779;">3511</td>
<td class="gt_row gt_right" style="background-color: #35B779;">25.6</td>
<td class="gt_row gt_right" style="background-color: #35B779;">1</td>
<td class="gt_row gt_right" style="background-color: #35B779;">0</td>
<td class="gt_row gt_right" style="background-color: #35B779;">0</td>
<td class="gt_row gt_right" style="background-color: #35B779;">0</td></tr>
    <tr><td class="gt_row gt_right" style="background-color: #35B779;">1</td>
<td class="gt_row gt_left" style="background-color: #35B779;">debt_consolidation</td>
<td class="gt_row gt_right" style="background-color: #35B779;">0.1008</td>
<td class="gt_row gt_right" style="background-color: #35B779;">162.34</td>
<td class="gt_row gt_right" style="background-color: #35B779;">11.35041</td>
<td class="gt_row gt_right" style="background-color: #35B779;">8.10</td>
<td class="gt_row gt_right" style="background-color: #35B779;">712</td>
<td class="gt_row gt_right" style="background-color: #35B779;">2699.958</td>
<td class="gt_row gt_right" style="background-color: #35B779;">33667</td>
<td class="gt_row gt_right" style="background-color: #35B779;">73.2</td>
<td class="gt_row gt_right" style="background-color: #35B779;">1</td>
<td class="gt_row gt_right" style="background-color: #35B779;">0</td>
<td class="gt_row gt_right" style="background-color: #35B779;">0</td>
<td class="gt_row gt_right" style="background-color: #35B779;">0</td></tr>
    <tr><td class="gt_row gt_right" style="background-color: #35B779;">1</td>
<td class="gt_row gt_left" style="background-color: #35B779;">credit_card</td>
<td class="gt_row gt_right" style="background-color: #35B779;">0.1426</td>
<td class="gt_row gt_right" style="background-color: #35B779;">102.92</td>
<td class="gt_row gt_right" style="background-color: #35B779;">11.29973</td>
<td class="gt_row gt_right" style="background-color: #35B779;">14.97</td>
<td class="gt_row gt_right" style="background-color: #35B779;">667</td>
<td class="gt_row gt_right" style="background-color: #35B779;">4066.000</td>
<td class="gt_row gt_right" style="background-color: #35B779;">4740</td>
<td class="gt_row gt_right" style="background-color: #35B779;">39.5</td>
<td class="gt_row gt_right" style="background-color: #35B779;">0</td>
<td class="gt_row gt_right" style="background-color: #35B779;">1</td>
<td class="gt_row gt_right" style="background-color: #35B779;">0</td>
<td class="gt_row gt_right" style="background-color: #35B779;">0</td></tr>
    <tr><td class="gt_row gt_right" style="background-color: #35B779;">1</td>
<td class="gt_row gt_left" style="background-color: #35B779;">credit_card</td>
<td class="gt_row gt_right" style="background-color: #35B779;">0.0788</td>
<td class="gt_row gt_right" style="background-color: #35B779;">125.13</td>
<td class="gt_row gt_right" style="background-color: #35B779;">11.90497</td>
<td class="gt_row gt_right" style="background-color: #35B779;">16.98</td>
<td class="gt_row gt_right" style="background-color: #35B779;">727</td>
<td class="gt_row gt_right" style="background-color: #35B779;">6120.042</td>
<td class="gt_row gt_right" style="background-color: #35B779;">50807</td>
<td class="gt_row gt_right" style="background-color: #35B779;">51.0</td>
<td class="gt_row gt_right" style="background-color: #35B779;">0</td>
<td class="gt_row gt_right" style="background-color: #35B779;">0</td>
<td class="gt_row gt_right" style="background-color: #35B779;">0</td>
<td class="gt_row gt_right" style="background-color: #35B779;">0</td></tr>
  </tbody>
  
  
</table>
</div>
<p>The loan data consists of one character variable (‘purpose’ = loan type) and 13 numeric variables. Let’s use <code>geom_col()</code> to plot the number of times each loan type is represented in the dataset.</p>
<pre class="r"><code>loans %&gt;% 
  count(purpose) %&gt;% 
  mutate(purpose = fct_reorder(purpose, n)) %&gt;% 
  ggplot(aes(n, purpose, fill = purpose)) +
  geom_col() +
  labs(title = &#39;Loan count by type&#39;,
       x = &#39;Count&#39;,
       y = &#39;&#39;) +
  theme(legend.position = &#39;none&#39;) +
  scale_fill_viridis_d()</code></pre>
<div class="figure"><span id="fig:unnamed-chunk-4"></span>
<img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-4-1.png" alt="Counts of each loan type" width="672" />
<p class="caption">
Figure 1: Counts of each loan type
</p>
</div>
<p>Numeric variables can be viewed as count distributions using <code>geom_histogram()</code>. Here, I use the <code>gather()</code> function to reshape the data into a long format and then <code>facet_wrap()</code> can be used to display each histogram in a single figure.</p>
<pre class="r"><code>loans[c(3:13)] %&gt;% 
  mutate(log_revol_bal = log(revol_bal)) %&gt;%
  select(-revol_bal) %&gt;% 
  gather() %&gt;% 
  ggplot(aes(value, fill = key)) +
  geom_histogram(alpha = 0.7) +
  facet_wrap(~key, scales = &#39;free&#39;) +
  labs(title = &#39;Count distributions for numeric variables&#39;) +
  theme(legend.position = &#39;none&#39;)</code></pre>
<pre><code>## Warning: Removed 321 rows containing non-finite values (stat_bin).</code></pre>
<div class="figure"><span id="fig:unnamed-chunk-5"></span>
<img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-5-1.png" alt="Histograms of all numeric variables" width="672" />
<p class="caption">
Figure 2: Histograms of all numeric variables
</p>
</div>
<p>The <code>credit_policy</code> and <code>not_fully_paid</code> variables (not shown above) are better represented as factors. They can be converted using the <code>recode_factor()</code> function. Let’s convert and explore these variables with boxplots.</p>
<pre class="r"><code>loans &lt;- loans %&gt;%             
  mutate(not_fully_paid = recode_factor(not_fully_paid, &#39;1&#39; = &#39;No&#39;, &#39;0&#39; = &#39;Yes&#39;),
         credit_policy = recode_factor(credit_policy, &#39;1&#39; = &#39;pass&#39;, &#39;0&#39; = &#39;fail&#39;),
         purpose = factor(purpose)) </code></pre>
<pre class="r"><code>loans %&gt;%
  select(-c(12:13)) %&gt;% 
  pivot_longer(!c(credit_policy, purpose, not_fully_paid)) %&gt;% 
  #filter(name != &#39;revol_bal&#39;) %&gt;% 
  ggplot(aes(value, fill = not_fully_paid)) +
  geom_boxplot()  +
  facet_wrap(~name, scales = &#39;free&#39;) + 
  labs(title = &quot;Comparing loan payment status across other variables&quot;,
       x = &quot;&quot;) +
  guides(fill = guide_legend(reverse=TRUE))</code></pre>
<div class="figure"><span id="fig:unnamed-chunk-7"></span>
<img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-7-1.png" alt="Boxplots comparing fully paid and not fully paid across numeric variables" width="672" />
<p class="caption">
Figure 3: Boxplots comparing fully paid and not fully paid across numeric variables
</p>
</div>
<pre class="r"><code>loans %&gt;%
  select(c(1:10)) %&gt;% 
  pivot_longer(!c(purpose, credit_policy)) %&gt;% 
  filter(name != &#39;revol_bal&#39;) %&gt;% 
  ggplot(aes(value, fill = credit_policy)) +
  geom_boxplot()  +
  facet_wrap(~name, scales = &#39;free&#39;) + 
  labs(title = &quot;Comparing credit policy across other variables&quot;,
       x = &quot;&quot;) +
  guides(fill = guide_legend(reverse=TRUE))</code></pre>
<div class="figure"><span id="fig:unnamed-chunk-8"></span>
<img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-8-1.png" alt="Boxplots of numeric features across credit risk assessment" width="672" />
<p class="caption">
Figure 4: Boxplots of numeric features across credit risk assessment
</p>
</div>
<p>The loan type can also be viewed with <code>boxplot()</code> but the categories are a little scrunched.</p>
<pre class="r"><code>loans %&gt;%
  select(-c(9, 11:13)) %&gt;% 
  pivot_longer(!c(credit_policy, purpose, not_fully_paid)) %&gt;% 
  #filter(name != &#39;revol_bal&#39;) %&gt;% 
  ggplot(aes(value, fill = purpose)) +
  geom_boxplot()  +
  facet_wrap(~name, scales = &#39;free&#39;) + 
  labs(title = &quot;Comparing loan payment status across other variables&quot;,
       x = &quot;&quot;) +
  guides(fill = guide_legend(reverse=TRUE))</code></pre>
<div class="figure"><span id="fig:unnamed-chunk-9"></span>
<img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-9-1.png" alt="Boxplots of numeric features across loan types" width="672" />
<p class="caption">
Figure 5: Boxplots of numeric features across loan types
</p>
</div>
<p>The <code>geom_density_ridges()</code> function from the ggridges package is an alternative way to view a numeric distribution across multiple categories.</p>
<pre class="r"><code>a &lt;- loans %&gt;% 
  add_count(purpose) %&gt;% 
  mutate(purpose = fct_reorder(purpose, n)) %&gt;%
  group_by(purpose) %&gt;% 
  ggplot(aes(int_rate, purpose, fill = purpose)) +
  geom_density_ridges() +
  labs(title = &#39;Density of the interest rate by loan purpose&#39;,
       x= &#39;Interest rate&#39;,
       y= &#39;&#39;) +
  theme(legend.position = &#39;none&#39;) +
  scale_fill_viridis_d(alpha = 0.4) +
  theme(panel.grid.minor = element_blank(), panel.border = element_blank())

b &lt;- loans %&gt;% 
  add_count(purpose) %&gt;% 
  mutate(purpose = fct_reorder(purpose, n)) %&gt;%
  group_by(purpose) %&gt;% 
  ggplot(aes(dti, purpose, fill = purpose)) +
  geom_density_ridges() +
  # scale_y_discrete(expand = c(0.01, 0)) +
  # scale_x_continuous(expand = c(0.01, 0)) +
  #theme_ridges() + 
  labs(title = &#39;Density of the debt-to-income ratio by loan purpose&#39;,
       x= &#39;dti&#39;,
       y= &#39;&#39;) +
  theme(legend.position = &#39;none&#39;) +
  scale_fill_viridis_d(alpha = 0.4) +
  theme(panel.grid.minor = element_blank(), panel.border = element_blank())

(a  / b)</code></pre>
<pre><code>## Picking joint bandwidth of 0.00625</code></pre>
<pre><code>## Picking joint bandwidth of 1.57</code></pre>
<div class="figure"><span id="fig:unnamed-chunk-10"></span>
<img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-10-1.png" alt="Density plots of interest rate and debt-to-interest across loan types" width="672" />
<p class="caption">
Figure 6: Density plots of interest rate and debt-to-interest across loan types
</p>
</div>
<pre class="r"><code>c &lt;- loans %&gt;% 
  add_count(purpose) %&gt;% 
  mutate(purpose = fct_reorder(purpose, n)) %&gt;%
  group_by(purpose) %&gt;% 
  ggplot(aes(revol_util, purpose, fill = purpose)) +
  geom_density_ridges() +
  labs(title = &#39;Density of the revol_util by loan purpose&#39;,
       x= &#39;revol_util&#39;,
       y= &#39;&#39;) +
  theme(legend.position = &#39;none&#39;) +
  scale_fill_viridis_d(alpha = 0.4) +
  theme(panel.grid.minor = element_blank(), panel.border = element_blank())

d &lt;- loans %&gt;% 
  add_count(purpose) %&gt;% 
  mutate(purpose = fct_reorder(purpose, n)) %&gt;%
  group_by(purpose) %&gt;% 
  ggplot(aes(installment, purpose, fill = purpose)) +
  geom_density_ridges() +
  labs(title = &#39;Density of the installment by loan purpose&#39;,
       x= &#39;installment&#39;,
       y= &#39;&#39;) +
  theme(legend.position = &#39;none&#39;) +
  scale_fill_viridis_d(alpha = 0.4) +
  theme(panel.grid.minor = element_blank(), panel.border = element_blank())

(c / d)</code></pre>
<pre><code>## Picking joint bandwidth of 6.58</code></pre>
<pre><code>## Picking joint bandwidth of 41.9</code></pre>
<div class="figure"><span id="fig:unnamed-chunk-11"></span>
<img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-11-1.png" alt="Density plots of revolving line utilization rate and installment variables across loan types" width="672" />
<p class="caption">
Figure 7: Density plots of revolving line utilization rate and installment variables across loan types
</p>
</div>
<p>The <code>ggpairs()</code> function from the GGally package is a great way to summarize correlations between our variables.</p>
<pre class="r"><code>loans[c(3:8, 10)] %&gt;% 
  sample_n(size = 500) %&gt;% 
  ggpairs()</code></pre>
<div class="figure"><span id="fig:unnamed-chunk-12"></span>
<img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-12-1.png" alt="Correlation values between numeric variables" width="672" />
<p class="caption">
Figure 8: Correlation values between numeric variables
</p>
</div>
</div>
<div id="modeling-challenges" class="section level1">
<h1>Modeling challenges</h1>
<p>Now that we have a feel for our data, let’s create some models!</p>
<ol style="list-style-type: decimal">
<li>Create a model that predicts the loan type (purpose)</li>
<li>Create model that predicts whether the loan has been payed back (not_fully_paid)</li>
<li>Create a model that predicts whether the loanee meets the accepted level of risk (credit_policy)</li>
</ol>
<div id="splitting-the-data" class="section level2">
<h2>Splitting the data</h2>
<p>The data is split into training and test sets using the default (prop = 0.75) split. 5-fold cross validation is used to create resamples from the training set.</p>
<pre class="r"><code>split &lt;- loans %&gt;% initial_split()
train &lt;- training(split) %&gt;% sample_n(size = 500)
test &lt;- testing(split)

resamps &lt;- vfold_cv(train, v = 5)</code></pre>
</div>
<div id="predicting-loan-type" class="section level2">
<h2>Predicting loan type</h2>
<p>To predict the loan type we will need to build a multiclass classification model. I am going to try three different models and compare the results to determine which model has the best predictive power.</p>
<div id="model-1-xgboost" class="section level3">
<h3>Model 1: Xgboost</h3>
<pre class="r"><code>#usemodels::use_xgboost(purpose ~ ., data = train)
xgboost_recipe &lt;-
  recipe(formula = purpose ~ ., data = train) %&gt;%
  step_novel(all_nominal(), -all_outcomes()) %&gt;%
  step_dummy(all_nominal(), -all_outcomes(), one_hot = TRUE) %&gt;%
  step_zv(all_predictors())

xgboost_spec &lt;-
  boost_tree(
    trees = 1000,
    tree_depth = tune(),
    min_n = tune(),
    mtry = tune(),
    sample_size = tune(),
    learn_rate = tune()
  ) %&gt;%
  set_engine(&quot;xgboost&quot;) %&gt;%
  set_mode(&quot;classification&quot;)

xgboost_workflow &lt;-
  workflow() %&gt;%
  add_recipe(xgboost_recipe) %&gt;%
  add_model(xgboost_spec)

# xgboost_grid_1 &lt;- grid_regular(
#   parameters(xgboost_spec),
#   levels = 3 )

# xgboost_grid_2 &lt;- grid_regular(
#   tree_depth(c(5L, 10L)),
#     min_n(c(10L, 40L)),
#     mtry(c(5L, 10L)),
#     learn_rate(c(-2, -1)),
#   sample_size=20
# )

set.seed(8390)
xgboost_tune &lt;-
  tune_grid(xgboost_workflow, resamples = resamps, grid = 20)</code></pre>
<pre><code>## i Creating pre-processing data to finalize unknown parameter: mtry</code></pre>
<pre class="r"><code>xgboost_tune %&gt;%
  autoplot()</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<pre class="r"><code>xg_best_params &lt;- xgboost_tune %&gt;%
  select_best(metric = &#39;accuracy&#39;)

xg_best_spec &lt;- xgboost_spec %&gt;%
  finalize_model(xg_best_params)

xg_final_fit &lt;- workflow() %&gt;%
  add_recipe(xgboost_recipe) %&gt;%
  add_model(xg_best_spec) %&gt;%
  last_fit(split = split)

xg_final_fit %&gt;%
  collect_metrics()</code></pre>
<pre><code>## # A tibble: 2 × 4
##   .metric  .estimator .estimate .config             
##   &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;               
## 1 accuracy multiclass     0.483 Preprocessor1_Model1
## 2 roc_auc  hand_till      0.697 Preprocessor1_Model1</code></pre>
<p>An accuracy of 44% does not seem great.</p>
</div>
<div id="model-2-random-forest" class="section level3">
<h3>Model 2: Random forest</h3>
<pre class="r"><code># usemodels::use_ranger(purpose ~ ., data = train)

ranger_recipe &lt;-
  recipe(formula = purpose ~ ., data = train)

ranger_spec &lt;-
  rand_forest(mtry = tune(),
              min_n = tune(),
              trees = 1000) %&gt;%
  set_mode(&quot;classification&quot;) %&gt;%
  set_engine(&quot;ranger&quot;)

rand_forest(mode = &quot;classification&quot;) %&gt;%
  set_engine(&quot;ranger&quot;, importance = &quot;impurity&quot;) %&gt;%
  fit(purpose ~ .,
      data = train) %&gt;%
  vip::vip(geom = &#39;point&#39;,
           aesthetics = list(color = &#39;midnightblue&#39;, size = 4)) +
  labs(title = &#39;test&#39;)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<pre class="r"><code>ranger_workflow &lt;-
  workflow() %&gt;%
  add_recipe(ranger_recipe) %&gt;%
  add_model(ranger_spec)

# ranger_grid &lt;- grid_regular(
#   parameters(ranger_spec),
#   mtry(range = c(10, 30)),
#   min_n(range = c(2, 8)),
#   levels = 3)

set.seed(57341)
ranger_tune &lt;-
  tune_grid(ranger_workflow,
            resamples = resamps,
            grid = 20)</code></pre>
<pre><code>## i Creating pre-processing data to finalize unknown parameter: mtry</code></pre>
<pre class="r"><code>ranger_tune %&gt;%
  autoplot()</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-15-2.png" width="672" /></p>
<pre class="r"><code>rf_best_params &lt;- ranger_tune %&gt;%
  select_best(metric = &#39;accuracy&#39;)

rf_best_spec &lt;- ranger_spec %&gt;%
  finalize_model(rf_best_params)

rf_final_fit &lt;- workflow() %&gt;%
  add_recipe(ranger_recipe) %&gt;%
  add_model(rf_best_spec) %&gt;%
  last_fit(split = split)

rf_final_fit %&gt;%
  collect_metrics()</code></pre>
<pre><code>## # A tibble: 2 × 4
##   .metric  .estimator .estimate .config             
##   &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;               
## 1 accuracy multiclass     0.479 Preprocessor1_Model1
## 2 roc_auc  hand_till      0.682 Preprocessor1_Model1</code></pre>
</div>
<div id="model-3-k-nearest-neighbors" class="section level3">
<h3>Model 3: K-nearest neighbors</h3>
<pre class="r"><code>#usemodels::use_kknn(purpose ~ ., data = train)

kknn_recipe &lt;-
  recipe(formula = purpose ~ ., data = train) %&gt;%
  step_novel(all_nominal(), -all_outcomes()) %&gt;%
  step_dummy(all_nominal(), -all_outcomes()) %&gt;%
  step_zv(all_predictors()) %&gt;%
  step_normalize(all_predictors(), -all_nominal())

kknn_spec &lt;-
  nearest_neighbor(neighbors = tune(), weight_func = tune()) %&gt;%
  set_mode(&quot;classification&quot;) %&gt;%
  set_engine(&quot;kknn&quot;)

kknn_workflow &lt;-
  workflow() %&gt;%
  add_recipe(kknn_recipe) %&gt;%
  add_model(kknn_spec)

knn_grid &lt;- grid_regular(
  parameters(kknn_spec),
  mtry(range = c(10, 30)),
  levels = 5)

set.seed(78590)
kknn_tune &lt;-
  tune_grid(kknn_workflow,
            resamples = resamps,
            grid = knn_grid)

kknn_tune %&gt;%
  autoplot()</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<pre class="r"><code>knn_best_params &lt;- kknn_tune %&gt;%
  select_best(metric = &#39;accuracy&#39;)

knn_best_spec &lt;- kknn_spec %&gt;%
  finalize_model(knn_best_params)

knn_final_fit &lt;- workflow() %&gt;%
  add_recipe(kknn_recipe) %&gt;%
  add_model(knn_best_spec) %&gt;%
  last_fit(split = split)

knn_final_fit %&gt;%
  collect_metrics()</code></pre>
<pre><code>## # A tibble: 2 × 4
##   .metric  .estimator .estimate .config             
##   &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;               
## 1 accuracy multiclass     0.438 Preprocessor1_Model1
## 2 roc_auc  hand_till      0.613 Preprocessor1_Model1</code></pre>
<pre class="r"><code>knn_final_fit %&gt;%
  collect_predictions()</code></pre>
<pre><code>## # A tibble: 2,395 × 12
##    id               .pred_all_other .pred_credit_ca… .pred_debt_cons… .pred_education…
##    &lt;chr&gt;                      &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;
##  1 train/test split          0.2              0.467             0.133           0     
##  2 train/test split          0.133            0.4               0.333           0.0667
##  3 train/test split          0.0667           0.267             0.667           0     
##  4 train/test split          0.333            0.133             0.333           0     
##  5 train/test split          0.4              0.2               0.333           0     
##  6 train/test split          0                0.133             0.8             0     
##  7 train/test split          0.467            0.333             0.2             0     
##  8 train/test split          0.6              0.0667            0.2             0     
##  9 train/test split          0.333            0.2               0.133           0.0667
## 10 train/test split          0.4              0.4               0.133           0     
## # … with 2,385 more rows, and 7 more variables: .pred_home_improvement &lt;dbl&gt;,
## #   .pred_major_purchase &lt;dbl&gt;, .pred_small_business &lt;dbl&gt;, .row &lt;int&gt;,
## #   .pred_class &lt;fct&gt;, purpose &lt;fct&gt;, .config &lt;chr&gt;</code></pre>
<pre class="r"><code>models &lt;- c(&#39;xgboost&#39;, &#39;xgboost&#39;, &#39;random forrest&#39;, &#39;random forrest&#39;, &#39;knn&#39;, &#39;knn&#39;)
bind_rows(xg_final_fit %&gt;% collect_metrics(), rf_final_fit %&gt;% collect_metrics(), knn_final_fit %&gt;%
  collect_metrics()) %&gt;% 
  mutate(models = models) %&gt;%
  select(models, everything(), -.config) %&gt;% 
  gt() %&gt;%
  tab_header(title = &#39;Model Results&#39;)  %&gt;%
  tab_options(container.height = 400,
              container.overflow.y = TRUE,
              heading.background.color = &quot;#21908CFF&quot;,
              table.width = &quot;75%&quot;,
              column_labels.background.color = &quot;black&quot;,
              table.font.color = &quot;black&quot;) %&gt;%
  tab_style(style = list(cell_fill(color = &quot;#35B779FF&quot;)),
            locations = cells_body())</code></pre>
<div id="aezpqtaaqa" style="overflow-x:auto;overflow-y:auto;width:auto;height:400px;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#aezpqtaaqa .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: black;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: 75%;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#aezpqtaaqa .gt_heading {
  background-color: #21908CFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#aezpqtaaqa .gt_title {
  color: #FFFFFF;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#aezpqtaaqa .gt_subtitle {
  color: #FFFFFF;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#aezpqtaaqa .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#aezpqtaaqa .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#aezpqtaaqa .gt_col_heading {
  color: #FFFFFF;
  background-color: black;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#aezpqtaaqa .gt_column_spanner_outer {
  color: #FFFFFF;
  background-color: black;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#aezpqtaaqa .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#aezpqtaaqa .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#aezpqtaaqa .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#aezpqtaaqa .gt_group_heading {
  padding: 8px;
  color: black;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#aezpqtaaqa .gt_empty_group_heading {
  padding: 0.5px;
  color: black;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#aezpqtaaqa .gt_from_md > :first-child {
  margin-top: 0;
}

#aezpqtaaqa .gt_from_md > :last-child {
  margin-bottom: 0;
}

#aezpqtaaqa .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#aezpqtaaqa .gt_stub {
  color: black;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#aezpqtaaqa .gt_summary_row {
  color: black;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#aezpqtaaqa .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#aezpqtaaqa .gt_grand_summary_row {
  color: black;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#aezpqtaaqa .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#aezpqtaaqa .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#aezpqtaaqa .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#aezpqtaaqa .gt_footnotes {
  color: black;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#aezpqtaaqa .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#aezpqtaaqa .gt_sourcenotes {
  color: black;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#aezpqtaaqa .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#aezpqtaaqa .gt_left {
  text-align: left;
}

#aezpqtaaqa .gt_center {
  text-align: center;
}

#aezpqtaaqa .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#aezpqtaaqa .gt_font_normal {
  font-weight: normal;
}

#aezpqtaaqa .gt_font_bold {
  font-weight: bold;
}

#aezpqtaaqa .gt_font_italic {
  font-style: italic;
}

#aezpqtaaqa .gt_super {
  font-size: 65%;
}

#aezpqtaaqa .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}
</style>
<table class="gt_table">
  <thead class="gt_header">
    <tr>
      <th colspan="4" class="gt_heading gt_title gt_font_normal gt_bottom_border" style>Model Results</th>
    </tr>
    
  </thead>
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">models</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">.metric</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">.estimator</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">.estimate</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left" style="background-color: #35B779;">xgboost</td>
<td class="gt_row gt_left" style="background-color: #35B779;">accuracy</td>
<td class="gt_row gt_left" style="background-color: #35B779;">multiclass</td>
<td class="gt_row gt_right" style="background-color: #35B779;">0.4830898</td></tr>
    <tr><td class="gt_row gt_left" style="background-color: #35B779;">xgboost</td>
<td class="gt_row gt_left" style="background-color: #35B779;">roc_auc</td>
<td class="gt_row gt_left" style="background-color: #35B779;">hand_till</td>
<td class="gt_row gt_right" style="background-color: #35B779;">0.6970466</td></tr>
    <tr><td class="gt_row gt_left" style="background-color: #35B779;">random forrest</td>
<td class="gt_row gt_left" style="background-color: #35B779;">accuracy</td>
<td class="gt_row gt_left" style="background-color: #35B779;">multiclass</td>
<td class="gt_row gt_right" style="background-color: #35B779;">0.4793319</td></tr>
    <tr><td class="gt_row gt_left" style="background-color: #35B779;">random forrest</td>
<td class="gt_row gt_left" style="background-color: #35B779;">roc_auc</td>
<td class="gt_row gt_left" style="background-color: #35B779;">hand_till</td>
<td class="gt_row gt_right" style="background-color: #35B779;">0.6817425</td></tr>
    <tr><td class="gt_row gt_left" style="background-color: #35B779;">knn</td>
<td class="gt_row gt_left" style="background-color: #35B779;">accuracy</td>
<td class="gt_row gt_left" style="background-color: #35B779;">multiclass</td>
<td class="gt_row gt_right" style="background-color: #35B779;">0.4384134</td></tr>
    <tr><td class="gt_row gt_left" style="background-color: #35B779;">knn</td>
<td class="gt_row gt_left" style="background-color: #35B779;">roc_auc</td>
<td class="gt_row gt_left" style="background-color: #35B779;">hand_till</td>
<td class="gt_row gt_right" style="background-color: #35B779;">0.6126532</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
<div id="predicting-loan-risk-status-credit-policy" class="section level2">
<h2>Predicting loan risk status (credit policy)</h2>
<p>The following two predictive models use xgboost.</p>
<pre class="r"><code># #usemodels::use_xgboost(credit_policy ~ ., data = train)

xgboost_recipe &lt;-
  recipe(formula = credit_policy ~ ., data = train) %&gt;%
  step_novel(all_nominal(), -all_outcomes()) %&gt;%
  step_dummy(all_nominal(), -all_outcomes(), one_hot = TRUE) %&gt;%
  step_zv(all_predictors())

xgboost_spec &lt;-
  boost_tree(trees = tune(), min_n = tune(), tree_depth = tune(), learn_rate = tune(),
    loss_reduction = tune(), sample_size = tune()) %&gt;%
  set_mode(&quot;classification&quot;) %&gt;%
  set_engine(&quot;xgboost&quot;)

xgboost_workflow &lt;-
  workflow() %&gt;%
  add_recipe(xgboost_recipe) %&gt;%
  add_model(xgboost_spec)

set.seed(10500)
xgboost_tune &lt;-
  tune_grid(xgboost_workflow, resamples = resamps, grid = 10)

xgboost_tune %&gt;%
  autoplot()</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<pre class="r"><code>xg_best_params &lt;- xgboost_tune %&gt;%
  select_best(metric = &#39;accuracy&#39;)

xg_best_spec &lt;- xgboost_spec %&gt;%
  finalize_model(xg_best_params)

xg_final_fit &lt;- workflow() %&gt;%
  add_recipe(xgboost_recipe) %&gt;%
  add_model(xg_best_spec) %&gt;%
  last_fit(split = split)

xg_final_fit %&gt;%
  collect_metrics() %&gt;% 
  gt() %&gt;%
  tab_header(title = &#39;Loan risk prediction results&#39;)  %&gt;%
  tab_options(container.height = 400,
              container.overflow.y = TRUE,
              heading.background.color = &quot;#21908CFF&quot;,
              table.width = &quot;75%&quot;,
              column_labels.background.color = &quot;black&quot;,
              table.font.color = &quot;black&quot;) %&gt;%
  tab_style(style = list(cell_fill(color = &quot;#35B779FF&quot;)),
            locations = cells_body())</code></pre>
<div id="tumwjtjkxa" style="overflow-x:auto;overflow-y:auto;width:auto;height:400px;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#tumwjtjkxa .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: black;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: 75%;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#tumwjtjkxa .gt_heading {
  background-color: #21908CFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#tumwjtjkxa .gt_title {
  color: #FFFFFF;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#tumwjtjkxa .gt_subtitle {
  color: #FFFFFF;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#tumwjtjkxa .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#tumwjtjkxa .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#tumwjtjkxa .gt_col_heading {
  color: #FFFFFF;
  background-color: black;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#tumwjtjkxa .gt_column_spanner_outer {
  color: #FFFFFF;
  background-color: black;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#tumwjtjkxa .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#tumwjtjkxa .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#tumwjtjkxa .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#tumwjtjkxa .gt_group_heading {
  padding: 8px;
  color: black;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#tumwjtjkxa .gt_empty_group_heading {
  padding: 0.5px;
  color: black;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#tumwjtjkxa .gt_from_md > :first-child {
  margin-top: 0;
}

#tumwjtjkxa .gt_from_md > :last-child {
  margin-bottom: 0;
}

#tumwjtjkxa .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#tumwjtjkxa .gt_stub {
  color: black;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#tumwjtjkxa .gt_summary_row {
  color: black;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#tumwjtjkxa .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#tumwjtjkxa .gt_grand_summary_row {
  color: black;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#tumwjtjkxa .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#tumwjtjkxa .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#tumwjtjkxa .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#tumwjtjkxa .gt_footnotes {
  color: black;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#tumwjtjkxa .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#tumwjtjkxa .gt_sourcenotes {
  color: black;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#tumwjtjkxa .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#tumwjtjkxa .gt_left {
  text-align: left;
}

#tumwjtjkxa .gt_center {
  text-align: center;
}

#tumwjtjkxa .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#tumwjtjkxa .gt_font_normal {
  font-weight: normal;
}

#tumwjtjkxa .gt_font_bold {
  font-weight: bold;
}

#tumwjtjkxa .gt_font_italic {
  font-style: italic;
}

#tumwjtjkxa .gt_super {
  font-size: 65%;
}

#tumwjtjkxa .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}
</style>
<table class="gt_table">
  <thead class="gt_header">
    <tr>
      <th colspan="4" class="gt_heading gt_title gt_font_normal gt_bottom_border" style>Loan risk prediction results</th>
    </tr>
    
  </thead>
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">.metric</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">.estimator</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">.estimate</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">.config</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left" style="background-color: #35B779;">accuracy</td>
<td class="gt_row gt_left" style="background-color: #35B779;">binary</td>
<td class="gt_row gt_right" style="background-color: #35B779;">0.9824635</td>
<td class="gt_row gt_left" style="background-color: #35B779;">Preprocessor1_Model1</td></tr>
    <tr><td class="gt_row gt_left" style="background-color: #35B779;">roc_auc</td>
<td class="gt_row gt_left" style="background-color: #35B779;">binary</td>
<td class="gt_row gt_right" style="background-color: #35B779;">0.9884306</td>
<td class="gt_row gt_left" style="background-color: #35B779;">Preprocessor1_Model1</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
<div id="predicting-loan-payment-status" class="section level2">
<h2>Predicting loan payment status</h2>
<pre class="r"><code>#usemodels::use_xgboost(not_fully_paid ~ ., data = train)

xgboost_recipe &lt;-
  recipe(formula = not_fully_paid ~ ., data = train) %&gt;%
  step_string2factor(purpose, not_fully_paid) %&gt;%
  step_novel(all_nominal(), -all_outcomes()) %&gt;%
  step_dummy(all_nominal(), -all_outcomes(), one_hot = TRUE) %&gt;%
  step_zv(all_predictors())

xgboost_spec &lt;-
  boost_tree(trees = tune(), learn_rate = tune()) %&gt;%
  set_mode(&quot;classification&quot;) %&gt;%
  set_engine(&quot;xgboost&quot;)

boost_tree(mode = &quot;classification&quot;) %&gt;%
  set_engine(&quot;xgboost&quot;, importance = &quot;impurity&quot;) %&gt;%
  fit(purpose ~ .,
      data = train) %&gt;%
  vip::vip(geom = &#39;point&#39;,
           aesthetics = list(color = &#39;midnightblue&#39;, size = 4)) +
  labs(title = &#39;test&#39;)</code></pre>
<pre><code>## [13:15:04] WARNING: amalgamation/../src/learner.cc:573: 
## Parameters: { &quot;importance&quot; } might not be used.
## 
##   This may not be accurate due to some parameters are only used in language bindings but
##   passed down to XGBoost core.  Or some parameters are not used but slip through this
##   verification. Please open an issue if you find above cases.
## 
## 
## [13:15:04] WARNING: amalgamation/../src/learner.cc:1095: Starting in XGBoost 1.3.0, the default evaluation metric used with the objective &#39;multi:softprob&#39; was changed from &#39;merror&#39; to &#39;mlogloss&#39;. Explicitly set eval_metric if you&#39;d like to restore the old behavior.</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<pre class="r"><code>xgboost_workflow &lt;-
  workflow() %&gt;%
  add_recipe(xgboost_recipe) %&gt;%
  add_model(xgboost_spec)

xgboost_grid &lt;- grid_regular(
  parameters(xgboost_spec),
  levels = 3 )

set.seed(0826)
xgboost_tune &lt;-
  tune_grid(xgboost_workflow,
            resamples = resamps,
            control = control_grid(),
            grid = xgboost_grid)

xgboost_tune %&gt;%
  autoplot()</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-19-2.png" width="672" /></p>
<pre class="r"><code>xg_best_params &lt;- xgboost_tune %&gt;%
  select_best(metric = &#39;accuracy&#39;)

xg_best_spec &lt;- xgboost_spec %&gt;%
  finalize_model(xg_best_params)

xg_final_fit &lt;- workflow() %&gt;%
  add_recipe(xgboost_recipe) %&gt;%
  add_model(xg_best_spec) %&gt;%
  last_fit(split = split)

xg_final_fit %&gt;%
  collect_metrics() %&gt;% 
  gt() %&gt;%
  tab_header(title = &#39;Payment status prediction results&#39;)  %&gt;%
  tab_options(container.height = 400,
              container.overflow.y = TRUE,
              heading.background.color = &quot;#21908CFF&quot;,
              table.width = &quot;75%&quot;,
              column_labels.background.color = &quot;black&quot;,
              table.font.color = &quot;black&quot;) %&gt;%
  tab_style(style = list(cell_fill(color = &quot;#35B779FF&quot;)),
            locations = cells_body())</code></pre>
<div id="arivpdltae" style="overflow-x:auto;overflow-y:auto;width:auto;height:400px;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#arivpdltae .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: black;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: 75%;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#arivpdltae .gt_heading {
  background-color: #21908CFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#arivpdltae .gt_title {
  color: #FFFFFF;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#arivpdltae .gt_subtitle {
  color: #FFFFFF;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#arivpdltae .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#arivpdltae .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#arivpdltae .gt_col_heading {
  color: #FFFFFF;
  background-color: black;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#arivpdltae .gt_column_spanner_outer {
  color: #FFFFFF;
  background-color: black;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#arivpdltae .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#arivpdltae .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#arivpdltae .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#arivpdltae .gt_group_heading {
  padding: 8px;
  color: black;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#arivpdltae .gt_empty_group_heading {
  padding: 0.5px;
  color: black;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#arivpdltae .gt_from_md > :first-child {
  margin-top: 0;
}

#arivpdltae .gt_from_md > :last-child {
  margin-bottom: 0;
}

#arivpdltae .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#arivpdltae .gt_stub {
  color: black;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#arivpdltae .gt_summary_row {
  color: black;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#arivpdltae .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#arivpdltae .gt_grand_summary_row {
  color: black;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#arivpdltae .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#arivpdltae .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#arivpdltae .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#arivpdltae .gt_footnotes {
  color: black;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#arivpdltae .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#arivpdltae .gt_sourcenotes {
  color: black;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#arivpdltae .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#arivpdltae .gt_left {
  text-align: left;
}

#arivpdltae .gt_center {
  text-align: center;
}

#arivpdltae .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#arivpdltae .gt_font_normal {
  font-weight: normal;
}

#arivpdltae .gt_font_bold {
  font-weight: bold;
}

#arivpdltae .gt_font_italic {
  font-style: italic;
}

#arivpdltae .gt_super {
  font-size: 65%;
}

#arivpdltae .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}
</style>
<table class="gt_table">
  <thead class="gt_header">
    <tr>
      <th colspan="4" class="gt_heading gt_title gt_font_normal gt_bottom_border" style>Payment status prediction results</th>
    </tr>
    
  </thead>
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">.metric</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">.estimator</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">.estimate</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">.config</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left" style="background-color: #35B779;">accuracy</td>
<td class="gt_row gt_left" style="background-color: #35B779;">binary</td>
<td class="gt_row gt_right" style="background-color: #35B779;">0.8308977</td>
<td class="gt_row gt_left" style="background-color: #35B779;">Preprocessor1_Model1</td></tr>
    <tr><td class="gt_row gt_left" style="background-color: #35B779;">roc_auc</td>
<td class="gt_row gt_left" style="background-color: #35B779;">binary</td>
<td class="gt_row gt_right" style="background-color: #35B779;">0.6414623</td>
<td class="gt_row gt_left" style="background-color: #35B779;">Preprocessor1_Model1</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
